<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Plataforma Municipal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="noticias-test.component.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<div class="bootstrap-wrapper">
  <div class="container-fluid">
    
    <!-- Header 
    <div class="row mb-4">
      <div class="col-12">
        <h1 class="text-center title-wine">üß™ P√°gina de Prueba - Sistema de Noticias</h1>
        <p class="text-center text-muted">Prueba la carga de im√°genes y gesti√≥n de noticias</p>
        
        
        <div class="auth-panel text-center mb-3">
          <div *ngIf="!isLoggedIn" class="alert alert-warning">
            <h5>‚ö†Ô∏è Autenticaci√≥n Requerida</h5>
            <p>Para crear y eliminar noticias necesitas estar autenticado como ADMIN</p>
            <button mat-raised-button color="primary" (click)="loginAutomatico()">
              <mat-icon>login</mat-icon>
              Login Autom√°tico (admin&#64;test.com)
            </button>
          </div>
          
          <div *ngIf="isLoggedIn" class="alert alert-success">
            <h5>‚úÖ Autenticado como {{ userRole }}</h5>
            <p>Ahora puedes crear y eliminar noticias</p>
            <button mat-raised-button color="warn" (click)="logout()">
              <mat-icon>logout</mat-icon>
              Cerrar Sesi√≥n
            </button>
          </div>
        </div>
      </div>
    </div>
-->
    <div class="row">
      
      <!-- FORMULARIO DE CREACI√ìN (Lado izquierdo) -->
      <div class="col-lg-5">
        <mat-card class="form-card">
          <mat-card-header>
            <mat-card-title class="text-wine">üìù Crear Nueva Noticia</mat-card-title>
          </mat-card-header>
          
          <mat-card-content>
            <form (ngSubmit)="crearNoticia()">
              
              <!-- T√≠tulo -->
              <mat-form-field class="full-width" appearance="outline">
                <mat-label>T√≠tulo</mat-label>
                <input 
                  matInput 
                  [(ngModel)]="noticia.titulo" 
                  name="titulo" 
                  placeholder="T√≠tulo de la noticia...">
                <mat-icon matSuffix>title</mat-icon>
              </mat-form-field>

              <!-- Autor -->
              <mat-form-field class="full-width" appearance="outline">
                <mat-label>Autor</mat-label>
                <input 
                  matInput 
                  [(ngModel)]="noticia.autor" 
                  name="autor" 
                  placeholder="Nombre del autor...">
                <mat-icon matSuffix>person</mat-icon>
              </mat-form-field>

              <!-- Descripci√≥n -->
              <mat-form-field class="full-width" appearance="outline">
                <mat-label>Descripci√≥n</mat-label>
                <textarea 
                  matInput 
                  [(ngModel)]="noticia.descripcion" 
                  name="descripcion" 
                  rows="3"
                  placeholder="Descripci√≥n de la noticia...">
                </textarea>
                <mat-icon matSuffix>description</mat-icon>
              </mat-form-field>

              <!-- Selecci√≥n de Imagen -->
              <div class="mb-3">
                <label class="form-label fw-bold text-wine">üì∑ Imagen</label>
                <input 
                  type="file" 
                  class="form-control" 
                  accept="image/*"
                  (change)="onImageSelected($event)">
              </div>

              <!-- Preview de la imagen -->
              <div *ngIf="imagenPreview" class="mb-3 text-center">
                <div class="preview-container">
                  <img [src]="imagenPreview" alt="Preview" class="img-preview">
                </div>
              </div>

              <!-- Botones -->
              <div class="d-flex gap-2">
                <button 
                  type="button" 
                  mat-raised-button 
                  color="accent"
                  (click)="limpiarFormulario()"
                  class="flex-fill">
                  <mat-icon>clear</mat-icon>
                  Limpiar
                </button>
                
                <button 
                  type="submit" 
                  mat-raised-button 
                  class="btn-wine flex-fill"
                  [disabled]="enviando">
                  <mat-icon>{{ enviando ? 'hourglass_empty' : 'save' }}</mat-icon>
                  {{ enviando ? 'Guardando...' : 'Crear' }}
                </button>
              </div>

            </form>
          </mat-card-content>
        </mat-card>
      </div>

      <!-- LISTA DE NOTICIAS (Lado derecho) -->
      <div class="col-lg-7">
        <mat-card class="list-card">
          <mat-card-header>
            <mat-card-title class="text-wine">üì∞ Noticias Creadas ({{ noticias.length }})</mat-card-title>
          </mat-card-header>
          
          <mat-card-content>
            
            <!-- Loading -->
            <div *ngIf="cargando" class="text-center p-4">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
              </div>
              <p class="mt-2">Cargando noticias...</p>
            </div>

            <!-- Sin noticias -->
            <div *ngIf="!cargando && noticias.length === 0" class="text-center p-4">
              <mat-icon class="empty-icon">sentiment_neutral</mat-icon>
              <h5>No hay noticias</h5>
              <p class="text-muted">Crea tu primera noticia usando el formulario</p>
            </div>

            <!-- Lista de noticias -->
            <div *ngIf="!cargando && noticias.length > 0" class="noticias-container">
              <div class="noticia-item" *ngFor="let noticia of noticias; let i = index">
                
                <!-- Imagen -->
                <div class="noticia-imagen">
                  <img 
                    [src]="'http://localhost:8080/uploads/' + noticia.imagen" 
                    [alt]="noticia.titulo"
                    (error)="$any($event.target).src='assets/images/noticia.jpeg'"
                    class="img-fluid">
                </div>
                
                <!-- Contenido -->
                <div class="noticia-contenido">
                  <h6 class="noticia-titulo">{{ noticia.titulo }}</h6>
                  <p class="noticia-autor">
                    <mat-icon class="icon-small">person</mat-icon>
                    {{ noticia.autor }}
                  </p>
                  <p class="noticia-descripcion">{{ noticia.descripcion }}</p>
                  <small class="noticia-fecha">
                    <mat-icon class="icon-small">schedule</mat-icon>
                    {{ formatearFecha(noticia.fecha!) }}
                  </small>
                </div>
                
                <!-- Acciones -->
                <div class="noticia-acciones">
                  <button 
                    mat-icon-button 
                    color="warn"
                    (click)="eliminarNoticia(noticia.id!)"
                    matTooltip="Eliminar">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
                
              </div>
            </div>

          </mat-card-content>
        </mat-card>
      </div>

    </div>

  </div>
</div>
